<!-- wysihtml core javascript with default toolbar functions --> 
<script src="/wysihtml/dist/wysihtml5x-toolbar.min.js"></script>
<!-- rules defining tags, attributes and classes that are allowed -->
<script src="/wysihtml/parser_rules/advanced_and_extended.js"></script>

<% include head.ejs %>
<% include simple_nav.ejs %>

<style type="text/css">
input#postTitle::selection{
  background: #66D9D3;
}
</style>

<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-2">

      <form role="form" style="margin-top:100px;">
        <div class="form-group">
          <label for="title">Title</label>
          <input name="title" type="text" class="form-control" id="postTitle" value="" style="width:500px; height:50px;">
        </div>
        <div class="form-group">
          <label for="body">Body</label>


          <!-- toolbar with suitable buttons and dialogues -->
          <div id="toolbar">
            <a class="btn btn-default" data-wysihtml5-command="bold">bold</a>
            <a class="btn btn-default" data-wysihtml5-command="italic">italic</a>
            <a class="btn btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1">H1</a>
            <a class="btn btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p">P</a>
           </div>
           <br />
          <!-- element to edit -->
          <textarea name="body" type="text" class="form-control" id="editor" rows="30" style="width:800px"></textarea>
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>

    </div>
  </div>
</div>

<script>
  var post = <%- JSON.stringify(post) %>;
  $(function(){
    $('#postTitle').val(post.title);
    $('#editor').val(post.body);
  })

  var editor = new wysihtml5.Editor('editor', {
    toolbar: 'toolbar',
    parserRules:  wysihtml5ParserRules
  });

  $('form').on('submit', function(event) {
    event.preventDefault();
    var form = $(this);
    var postData = form.serialize();
    var path = $(location).attr('pathname');

    if (path.split('/')[2] === 'new') {
      var type = 'POST';
      var url = '/posts';
    } else if (path.split('/')[2] === 'edit') {
      var type = 'PUT';
      var url = '/posts/'+ path.split('/')[3];
    }
    
    $.ajax({
      type: type,
      url: url,
      data: postData 
    }).done(function(value) {
      alert("sent");
      form.trigger('reset');
    });

  });

</script>